<cite>
**本文档中引用的文件**
- [Cargo.toml](file://Cargo.toml)
- [README.md](file://README.md)
- [src/lib.rs](file://src/lib.rs)
- [examples/basic_usage.rs](file://examples/basic_usage.rs)
</cite>

# 贡献指南

## 目录
1. [代码风格要求](#代码风格要求)
2. [测试要求](#测试要求)
3. [Pull Request提交流程](#pull-request提交流程)
4. [Cargo特性管理](#cargo特性管理)
5. [许可证合规性](#许可证合规性)

## 代码风格要求

本项目严格遵循Rust官方编码规范，确保代码的一致性和可维护性。

### 格式化与静态检查
所有代码必须通过`rustfmt`进行格式化，并通过`clippy`的静态分析检查。在提交代码前，请执行以下命令：

```bash
cargo fmt --all
cargo clippy --all-targets -- -D warnings
```

### 注释规范
所有公共API必须使用Rustdoc进行完整注释覆盖。文档注释应包含：
- 函数/方法的功能描述
- 参数说明（使用`# Arguments`）
- 返回值说明（使用`# Returns`）
- 安全性约束（对于`unsafe`代码，使用`# Safety`）
- 示例用法（使用`# Example`）

例如，在`ClockController::new`方法中，`unsafe`构造函数明确指出了调用者需要保证基地址的有效性。

### 命名约定
项目遵循Rust命名惯例：
- 模块、函数和变量使用`snake_case`
- 类型、结构体和枚举使用`PascalCase`
- 常量使用`UPPER_SNAKE_CASE`

**Section sources**
- [src/lib.rs](file://src/lib.rs#L70-L85)
- [src/lib.rs](file://src/lib.rs#L100-L115)

## 测试要求

为确保代码质量和功能正确性，所有新增功能必须附带相应的测试。

### 单元测试与集成测试
- **单元测试**：针对单个函数或模块的内部逻辑进行测试，验证边界条件和错误处理。
- **集成测试**：验证多个组件协同工作的正确性，特别是硬件抽象层与系统其他部分的交互。

### `no_std`环境下的验证
由于本驱动运行在`no_std`环境中，所有测试必须能够在无标准库环境下通过QEMU或其他仿真工具验证。示例代码`basic_usage.rs`展示了如何在`no_std`环境下初始化时钟并执行基本操作。

建议使用`cargo run`配合目标平台配置来验证代码在真实嵌入式环境中的行为。

**Section sources**
- [examples/basic_usage.rs](file://examples/basic_usage.rs#L1-L65)
- [src/lib.rs](file://src/lib.rs#L1-L275)

## Pull Request提交流程

为保持代码库的整洁和可追溯性，贡献者需遵循以下PR提交流程。

### 分支命名规则
创建功能分支时，应采用`feature/`、`fix/`或`docs/`前缀，后接简短描述：
- 新功能：`feature/clock-frequency-validation`
- Bug修复：`fix/timing-out-check`
- 文档更新：`docs/contribution-guide`

### 提交消息格式
提交消息应遵循[Conventional Commits](https://www.conventionalcommits.org/)规范：
```
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```
其中`type`可以是`feat`、`fix`、`docs`、`style`、`refactor`等，`scope`应指明影响的模块（如`clock_controller`）。

### CI/CD流水线预期结果
提交PR后，CI/CD流水线将自动执行以下检查：
1. 代码格式化检查（`cargo fmt`）
2. 静态分析（`cargo clippy`）
3. 构建测试（`cargo build --target thumbv7em-none-eabihf`）
4. 单元测试（如有）
5. 文档生成（`cargo doc`）

所有检查必须通过才能合并。

**Section sources**
- [README.md](file://README.md#L90-L120)

## Cargo特性管理

本项目使用Cargo特性（features）机制来管理可选依赖和功能模块。

### `axhal`特性的启用方式
`axhal`特性用于启用ArceOS硬件抽象层的集成支持。该特性目前被注释掉，表示尚未完全实现或默认不启用。

要启用`axhal`特性，需在`Cargo.toml`中取消相关注释：
```toml
[dependencies.axhal]
version = "0.1"
optional = true
default-features = false

[features]
axhal = ["dep:axhal"]
```

同时，示例程序的构建也需要相应调整，取消`required-features = ["axhal"]`的注释。

### 特性依赖关系
`axhal`特性依赖于外部的`axhal`包，且作为可选依赖（optional dependency），不会影响基础功能的构建。这种设计允许核心驱动独立工作，同时为特定平台提供扩展能力。

**Section sources**
- [Cargo.toml](file://Cargo.toml#L23-L39)

## 许可证合规性

本项目采用双许可证模式，贡献者必须理解并遵守相关要求。

### 双许可证条款
项目以GPL-2.0或Apache-2.0许可证发布，贡献者可以选择任一许可证条款进行分发。这意味着：
- **GPL-2.0**：要求衍生作品也必须以GPL-2.0发布，保证源码开放。
- **Apache-2.0**：允许更宽松的使用条件，包括专有软件中的使用，但需保留版权声明和NOTICE文件。

### 代码提交要求
所有提交的代码必须：
1. 不包含第三方版权代码，除非其许可证与本项目兼容。
2. 在文件头部明确声明许可证信息。
3. 确保贡献者拥有提交代码的合法权利。

通过遵循这些规定，我们共同维护一个开放、合规且可持续发展的开源社区。

**Section sources**
- [Cargo.toml](file://Cargo.toml#L8)
- [README.md](file://README.md#L105-L110)